# CoreVPN Helm Chart Values
# Override these values to customize your deployment

# -- Number of replicas (should be 1 for VPN server)
replicaCount: 1

image:
  # -- Image repository
  repository: ghcr.io/pegasusheavyindustries/corevpn
  # -- Image pull policy
  pullPolicy: IfNotPresent
  # -- Image tag (defaults to appVersion)
  tag: ""

# -- Image pull secrets
imagePullSecrets: []

# -- Override chart name
nameOverride: ""
# -- Override full name
fullnameOverride: ""

serviceAccount:
  # -- Create service account
  create: true
  # -- Annotations for service account
  annotations: {}
  # -- Service account name
  name: ""

# -- Pod annotations
podAnnotations: {}

# -- Pod security context
podSecurityContext:
  fsGroup: 1000

# -- Container security context
securityContext:
  capabilities:
    add:
      - NET_ADMIN
      - NET_RAW
      - NET_BIND_SERVICE
  readOnlyRootFilesystem: true

# VPN Server configuration
server:
  # -- Enable VPN server
  enabled: true

  # -- Public hostname for client configs
  # IMPORTANT: Change this to your server's public address
  publicHost: "vpn.example.com"

  # -- Listen port (UDP)
  port: 1194

  # -- Enable TCP fallback
  tcpEnabled: false
  # -- TCP port
  tcpPort: 443

  # -- Maximum concurrent clients
  maxClients: 100

  # -- VPN network subnet
  subnet: "10.8.0.0/24"

  # -- DNS servers to push to clients
  dns:
    - "1.1.1.1"
    - "1.0.0.1"

  # -- Enable full tunnel (redirect all traffic through VPN)
  redirectGateway: true

  # -- MTU setting
  mtu: 1420

  # -- Ghost mode - completely disable connection logging
  ghostMode: false

# Security settings
security:
  # -- Cipher suite (chacha20-poly1305 or aes-256-gcm)
  cipher: "chacha20-poly1305"
  # -- Minimum TLS version
  tlsMinVersion: "1.3"
  # -- Enable TLS auth
  tlsAuth: true
  # -- Enable TLS crypt (stronger than tlsAuth)
  tlsCrypt: false
  # -- CA certificate lifetime in days
  certLifetimeDays: 3650
  # -- Client certificate lifetime in days
  clientCertLifetimeDays: 90
  # -- Key renegotiation interval in seconds
  renegSec: 3600

# Logging configuration
logging:
  # -- Log level (trace, debug, info, warn, error)
  level: "info"
  # -- Log format (json or pretty)
  format: "json"

  # Connection logging mode
  # Options: none (ghost), memory, file, database, both
  connectionMode: "memory"

  # Events to log
  events:
    attempts: false
    connects: true
    disconnects: true
    authEvents: false
    transferStats: false
    ipChanges: false
    renegotiations: false

  # Anonymization options
  anonymization:
    hashClientIps: false
    truncateClientIps: false
    hashUsernames: false
    roundTimestamps: false
    aggregateTransferStats: false

  # Retention settings
  retention:
    days: 7
    autoPurge: true

# OAuth2 configuration (optional)
oauth:
  # -- Enable OAuth2 authentication
  enabled: false
  # -- Provider type (google, microsoft, okta, generic)
  provider: ""
  # -- OAuth2 client ID
  clientId: ""
  # -- Secret name containing OAuth2 client secret
  clientSecretRef: ""
  # -- Issuer URL (for generic OIDC)
  issuerUrl: ""
  # -- Tenant ID (for Microsoft)
  tenantId: ""
  # -- Domain (for Okta)
  domain: ""
  # -- Allowed email domains
  allowedDomains: []
  # -- Required groups
  requiredGroups: []

# Web UI configuration
web:
  # -- Enable web admin interface
  enabled: true
  # -- Listen port
  port: 8080
  # -- Number of replicas
  replicaCount: 1

  # Resources for web container
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 500m
      memory: 256Mi

# PKI/Certificates
pki:
  # -- Create PKI secret (set to false if providing existing secret)
  create: false
  # -- Existing secret name containing PKI certificates
  existingSecret: ""
  # -- CA certificate (base64 encoded)
  caCert: ""
  # -- CA key (base64 encoded)
  caKey: ""
  # -- Server certificate (base64 encoded)
  serverCert: ""
  # -- Server key (base64 encoded)
  serverKey: ""
  # -- TLS auth key (base64 encoded)
  taKey: ""

# Secrets
secrets:
  # -- Admin password for web UI
  adminPassword: ""
  # -- Existing secret name for admin password
  existingSecret: ""
  # -- Key in existing secret for admin password
  existingSecretKey: "admin-password"

# Service configuration
service:
  # -- Service type (LoadBalancer, NodePort, ClusterIP)
  type: LoadBalancer
  # -- Preserve client source IP
  externalTrafficPolicy: Local
  # -- Annotations for the service
  annotations: {}
  # -- Load balancer IP (if supported)
  loadBalancerIP: ""
  # -- Load balancer source ranges
  loadBalancerSourceRanges: []
  # -- NodePort for UDP (if type is NodePort)
  nodePort: 31194

# Ingress for web UI
ingress:
  # -- Enable ingress for web UI
  enabled: false
  # -- Ingress class name
  className: "nginx"
  # -- Ingress annotations
  annotations: {}
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  # -- Ingress hosts
  hosts:
    - host: vpn-admin.example.com
      paths:
        - path: /
          pathType: Prefix
  # -- TLS configuration
  tls: []
    # - secretName: corevpn-web-tls
    #   hosts:
    #     - vpn-admin.example.com

# Resource limits
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 1000m
    memory: 512Mi

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity rules
affinity: {}

# Pod disruption budget
podDisruptionBudget:
  # -- Enable PDB
  enabled: true
  # -- Maximum unavailable pods
  maxUnavailable: 0

# Network policies
networkPolicy:
  # -- Enable network policies
  enabled: false
  # -- Ingress namespace selector (for web UI)
  ingressNamespaceSelector:
    matchLabels:
      kubernetes.io/metadata.name: ingress-nginx

# Metrics/monitoring
metrics:
  # -- Enable Prometheus metrics
  enabled: false
  # -- Metrics port
  port: 9090
  # -- ServiceMonitor for Prometheus Operator
  serviceMonitor:
    enabled: false
    interval: 30s
    labels: {}
